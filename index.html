<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/octomin.css" />
		<link rel="stylesheet" type="text/css" href="css/bulma.0.7.1.css" />
		<link rel="stylesheet" type="text/css" href="css/dropzone.min.css" />
		
		<script src="js/config.js" type="text/javascript"></script>
		<script src="js/proxies.js" type="text/javascript"></script>
		<script src="js/bulma_slider.js" type="text/javascript"></script>
		<script src="js/jquery-3.4.1.slim.min.js" type="text/javascript"></script>
		<script src="js/api.js" type="text/javascript"></script>
		<script src="js/states.js" type="text/javascript"></script>
		<script src="js/dropzone.min.js"></script>
	</head>
	<body>

	<div id="dropzoneProgress">
		<div class="imgContainer"><img src="img/upload.gif"></div>
		<div class="textContainer"><h3>uploading...</h3></div>
	</div>
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="navbar-item" href="https://bulma.io">
				<!-- <img src="https://bulma.io/images/bulma-logo.png" alt="Bulma: Free, open source, & modern CSS framework based on Flexbox" width="112" height="28"> !-->
				Octo^^in
			</a>
		</div>
		<div id="navbarBasicExample" class="navbar-menu">
			<div class="navbar-start" style="width: 50%;">
				<div id="meta" class="field is-grouped is-grouped-multiline" style="margin: 14px 0px 0px 20%;">
					<div class="control" id="control_power">
						<div class="tags has-addons">
							<span class="tag">Strom</span>
							<a class="tag is-danger" id="tag_printer_power" onclick="powerswitch()">aus</a>
						</div>
					</div>

					<div class="control">
						<div class="tags has-addons">
							<span class="tag">Verbindung</span>
							<a class="tag is-danger" id="tag_btn_connect" onclick="printerConnection()">aus</a>
						</div>
					</div>

					<div class="control" id="control_light">
						<div class="tags has-addons">
							<span class="tag">Licht</span>
							<a class="tag is-danger" id="tag_lightswitch" onclick="lightswitch()">aus</a>
						</div>
					</div>
				</div>
			</div>
			<div class="navbar-end">
				<div class="navbar-item">
					<div class="buttons">
						<a class="button is-info is-small" onclick="infomodal('show')">Info</a>
					</div>
				</div>
			</div>
		</div>
	</nav>

	<div class="modal" id="infomodal">
		<div class="modal-background"></div>
		<div class="modal-card">
			<header class="modal-card-head">
				<p class="modal-card-title">Usage Information</p>
				<button class="delete" aria-label="close" onclick="infomodal('close')"></button>
			</header>
			<section class="modal-card-body">
				<div class="content">
					<h3>General</h3>
					<p>Octoprint installation is required for octo^^in to work and control your printer. Just edit &quot;config.js&quot;, set &quot;octo_ip&quot; to your octoprint ipaddress:port and set &quot;apikey&quot; to your octoprint's api key.</p>
					<h3>Uploading files</h3>
					<p>Navigate to the destination folder and just drag and drop the gcode file into this browser window.<br />For now, only uploading to octoprint's local storage is used.</p>
					<h3>Printer power</h3>
					<p>For switching the printer on/off I use a &quot;Sonoff POW with tasmota firmware&quot;. If you plan the same/similar setup, edit &quot;config.js&quot;, set your sonoff's ip-address and set &quot;var powerhandling = yes&quot;.</p>
					<h3>Light control</h3>
					<p>For switching the enclosure lights on/off I use a &quot;nodemcu flashed with esphome&quot;, integrated into homeassistant. If you plan the same/similar setup, edit &quot;config.js&quot;, set your led-controlling-device's ip-address and set &quot;var lighthandling = yes&quot;.</p>
				</div>
			</section>
			<footer class="modal-card-foot">
				<button class="button" onclick="infomodal('close')">Got it</button>
			</footer>
		</div>
	</div>

	<section class="section">
		<div class="container">

			<div class="columns">

			  <div class="column is-three-quarters">
			    <h2>Files & Folders</h2>
			    	<table class="table is-fullwidth is-striped is-hoverable" id="filestable">
			    		<thead>
						    <tr>
						      <th colspan="3">
								<div class="buttons" id="fileoperations">
									<span id="btn_load" class="button is-warning" disabled onclick="loadprintFile(false)">load</span>
									<span id="btn_print" class="button is-success" disabled onclick="loadprintFile(true)">print</span>
									<span id="btn_cancel" class="button is-danger" disabled onclick="cancelJob()">cancel</span>
									<span id="btn_delete" class="button is-danger" disabled onclick="deleteFile()">delete</span>
								</div>
						      </th>
						    </tr>
						</thead>
						<tbody id="filesbody">
						</tbody>
			    	</table>
			    
			  </div>


			  <div class="column">

				<div class="card">
				  <div class="card-image">
				    <figure class="image is-4by3">
				      <img src="" id="printerCam" alt="Printer image">
				    </figure>
				  </div>
				  <div class="card-content">
				    <div class="media">

				      <div class="media-content">
				        <p class="title is-4" id="printername"></p>
				        <p class="subtitle is-6" id="connectionstatus"></p>
				      </div>
				    </div>

				    <div class="content" id="cardprinterstatus">
				      <p>Printerstatus: <span id="printerstatus"></span></p>
				      <p>Tool-0 Temp: <span id="tool0tempactual"></span>&deg; C / <span id="tool0temptarget"></span>&deg; C</p>
				      <p>Bed Temp: <span id="bedtempactual"></span>&deg; C / <span id="bedtemptarget"></span>&deg; C</p>
				    </div>

				    <div class="content" id="cardtools" style="display: none; border-top: 1px solid #C0C0C0; height: 200px;">
						<div style="width: 25%; float: left; text-align: center;">
							<p>Extruder:</p>
							<input id="sliderExtruder" class="slider is-fullwidth is-danger is-small is-circle has-output" step="1" min="0" max="250" value="0" type="range" orient="vertical" onmouseup="setExtruderTemp(document.getElementById('sliderExtruder').value)"><output id="sliderextruderoutput" for="sliderExtruder">0</output>&deg;C
						</div>
						<div style="width: 25%; float: left; text-align: center;">
							<p>&nbsp;</p>
							<div class="temp_ist"><div id="temp_tool0_actual"></div></div>
						</div>
						<div style="width: 25%; float: left; text-align: center;">
							<p>Bed:</p>
							<input id="sliderBed" class="slider is-fullwidth is-info is-small is-circle has-output" step="1" min="0" max="90" value="0" type="range" orient="vertical" onmouseup="setBedTemp(document.getElementById('sliderBed').value)"><output id="sliderbedoutput" for="sliderBed">0</output>&deg;C
						</div>
						<div style="width: 25%; float: left; text-align: center;">
							<p>&nbsp;</p>
							<div class="temp_ist"><div id="temp_bed_actual"></div></div>
						</div>
				    </div>
				  </div>
				</div>
			  </div>
			</div>
		</div>
	</section>

	<footer class="footer">
	<div class="content has-text-centered">
		<p>
			<strong>Octo^^in</strong>
		</p>
		</div>
	</footer>

	<script>
	  var octoDropzone = new Dropzone(document.body, {
	    init: function() {
	    	this.on("sending", function(file, xhr, formData) {
				formData.append("path", getSelectedFolder());
				$("#dropzoneProgress").css("display", "block");
				$(".dz-preview").css("display", "none");
			});
			this.on("success", function() {
				$("#dropzoneProgress").css("display", "none");
				getFiles();
			});
		},
	    url: octo_ip+"/api/files/local"
	  });
	</script>


	</body>
</html>